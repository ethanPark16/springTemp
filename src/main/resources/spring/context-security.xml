<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:sec="http://www.springframework.org/schema/security"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
			http://www.springframework.org/schema/beans/spring-beans-4.0.xsd
			http://www.springframework.org/schema/security
			http://www.springframework.org/schema/security/spring-security-3.2.xsd">
	
	<sec:http pattern="/resources/**" security="none"></sec:http>		
    <sec:http auto-config="false">
    	<sec:logout invalidate-session="true" logout-url="/logout.do" logout-success-url="/"/>
    	<sec:access-denied-handler error-page="/403.do"/>
    	<sec:form-login login-page="/login.do" login-processing-url="/j_spring_security" default-target-url="/"
    				 username-parameter="userid" password-parameter="userpw" />
    	<sec:anonymous/>
    </sec:http>
	<sec:authentication-manager>
		<sec:authentication-provider user-service-ref="jdbcUserDetailsManager">
			<sec:password-encoder ref="passwordEncoder"></sec:password-encoder>
		</sec:authentication-provider>
	</sec:authentication-manager>
	
	<bean id="jdbcUserDetailsManager" class="com.pidotech.mari.cmm.security.MariJdbcUserDetailsManager">
		<property name="usersByUsernameQuery" value="SELECT USER_ID, PASSWORD, ENABLED, USER_NAME, DEPT_ID, DEPT_NM, ESNTL_ID FROM MOBILITY.USER_INFO_MST WHERE USER_ID = ?"></property>
		<property name="authoritiesByUsernameQuery" value="SELECT A.SCRTY_DTRMN_TRGET_ID USER_ID, A.AUTHOR_CODE AUTHORITY FROM MOBILITY.LETTNEMPLYRSCRTYESTBS A, MOBILITY.USER_INFO_MST B WHERE A.SCRTY_DTRMN_TRGET_ID = B.ESNTL_ID AND B.USER_ID = ?"></property>
		<property name="mapperClass" value="com.pidotech.mari.cmm.security.MariSessionMapping"/>
		<property name="roleHierarchy" ref="roleHierarchy"/>
		<property name="dataSource" ref="dataSource"/>
	</bean>
	
	<bean id="roleHierarchy" class="org.springframework.security.access.hierarchicalroles.RoleHierarchyImpl">
		<property name="hierarchy">
			<value>
				ROLE_ADMIN > ROLE_USER
			</value>
		</property>
	</bean>
	
	<bean id="passwordEncoder" class="org.springframework.security.crypto.password.StandardPasswordEncoder" />
	
</beans>
